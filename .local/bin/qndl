#!/bin/sh

# $1 is a url; $2 is a command

if [ -z "$1" ]; then
	exit 1
fi

base="$(basename -- "$1")"
cmd="$2"

notify-send "qndl" "â³ Queuing $base..."

if [ -z "$cmd" ]; then
	cmd="yt-dlp --embed-metadata -ic"
fi

idnum="$(tsp $cmd "$1")"
realname="$(echo "$base" | sed "s/?\(source\|dest\).*//;s/%20/ /g")"

if [ "$base" != "$realname" ]; then
	tsp -D "$idnum" mv "$base" "$realname"
fi
tsp -D "$idnum" notify-send "ğŸ‘ $realname done."
